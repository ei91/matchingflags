<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Include jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        /* Styling for the game */
        h1, header, div, h2 { text-align: center; }
        h1 { font-size: 30px; }
        header { font-size: 50px; font-weight: 400; }
        h2 { padding-top: 2%; font-size: 30px; }

        .card {
            display: inline-block;
            width: 120px;
            height: 160px;
            margin: 10px;
            border: 1px solid #ccc;
            border-radius: 8px;
            text-align: center;
            font-size: 14px;
            box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }

        .card-front, .card-back {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            backface-visibility: hidden;
            transition: transform 0.3s ease;
        }

        .card-front { background: white; }
        .card-back { background: white; font-weight: bold; color: #333; }

        .card img { max-width: 80px; max-height: 60px; margin-bottom: 8px; }

        .highlight-orange { border: 3px solid orange; }
        .highlight-green { border: 3px solid green; }

        .num-of-match-txt { font-size: 16px; color: green; }
        .message { font-size: 20px; color: blue; margin-top: 20px; }

        input[type="button"] {
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
        }

        input[type="button"]:hover { background-color: #0056b3; }
    </style>

    <script>
        $(document).ready(function() {
            let numOfMatches = 0;
            let flippedCards = [];
            let showAnswers = false;
            let totalPairs = 0;

            // Function to start or restart the game
            function startGame(boardSize) {
                numOfMatches = 0;
                flippedCards = [];
                showAnswers = false;
                totalPairs = boardSize;

                $('.num-of-match-txt').text('Number of matches: 0');
                $('.message').remove();

                const selectedRegion = $('input[name="region"]:checked').val();
                if (!selectedRegion) {
                    alert("Please select a region first!");
                    return;
                }

                fetch(`https://www.cs.kent.ac.uk/people/staff/yh/api/country-data/countries/region/${selectedRegion}`)
                    .then(response => response.json())
                    .then(data => {
                        const selectedCountries = [];
                        while (selectedCountries.length < totalPairs) {
                            const randomIndex = Math.floor(Math.random() * data.length);
                            const country = data[randomIndex];
                            if (!selectedCountries.some(c => c.name === country.name)) {
                                selectedCountries.push({
                                    name: country.name,
                                    flag: country.flag,
                                    capital: country.capital
                                });
                            }
                        }

                        let cardsArray = [];
                        selectedCountries.forEach(country => {
                            // Create flag and country-capital cards
                            cardsArray.push({
                                name: country.name,
                                type: 'flag',
                                content: `<img src="${country.flag}" alt="Flag of ${country.name}">`,
                                flag: country.flag,
                                capital: country.capital
                            });
                            cardsArray.push({
                                name: country.name,
                                type: 'text',
                                content: `<p>${country.name}</p><p>${country.capital}</p>`,
                                flag: country.flag,
                                capital: country.capital
                            });
                        });

                        // Shuffle cards
                        cardsArray.sort(() => Math.random() - 0.5);

                        // Clear previous board and render new cards
                        $('.game-container-board').empty();
                        cardsArray.forEach(item => {
                            const card = $('<div>')
                                .addClass('card')
                                .data({
                                    country: item.name,
                                    type: item.type,
                                    flagContent: `<img src="${item.flag}" alt="Flag of ${item.name}">`,
                                    textContent: `<p>${item.name}</p><p>${item.capital}</p>`
                                });

                            const frontCard = $('<div>').addClass('card-front').html(item.content);
                            const backCard = $('<div>').addClass('card-back');

                            if (item.type === 'flag') {
                                frontCard.show();
                                backCard.hide();
                            } else {
                                frontCard.hide();
                                backCard.html(item.content).show();
                            }

                            card.append(frontCard).append(backCard);
                            $('.game-container-board').append(card);
                            card.on('click', handleCardClick);
                        });
                    })
                    .catch(error => console.error("Error loading data:", error));
            }

            // Card click handler
            function handleCardClick() {
                if (showAnswers) return; // Disable clicks when showing answers

                const card = $(this);
                const frontCard = card.find('.card-front');
                const backCard = card.find('.card-back');

                if (flippedCards.length < 2 && !card.hasClass('matched')) {
                    frontCard.show();
                    backCard.hide();
                    flippedCards.push({
                        element: card,
                        country: card.data('country'),
                        type: card.data('type')
                    });
                    card.addClass('highlight-orange');

                    if (flippedCards.length === 2) {
                        checkMatch();
                    }
                }
            }

            // Check if two flipped cards match
            function checkMatch() {
                const [first, second] = flippedCards;
                if (first.country === second.country && first.type !== second.type) {
                    numOfMatches++;
                    $('.num-of-match-txt').text('Number of matches: ' + numOfMatches);
                    first.element.add(second.element)
                        .removeClass('highlight-orange')
                        .addClass('highlight-green')
                        .addClass('matched')
                        .off('click');
                    flippedCards = [];

                    if (numOfMatches === totalPairs) {
                        $('.game-container-board').after('<div class="message">Congratulations! You have matched all the countries with their flags!</div>');
                    }
                } else {
                    setTimeout(() => {
                        first.element.removeClass('highlight-orange');
                        first.element.find('.card-front').hide();
                        first.element.find('.card-back').show();
                        second.element.removeClass('highlight-orange');
                        second.element.find('.card-front').hide();
                        second.element.find('.card-back').show();
                        flippedCards = [];
                    }, 500);
                }
            }

            // Toggle 'Show Answer' state
            $('#show-answer').click(function() {
                showAnswers = !showAnswers;

                if (showAnswers) {
                    $('.card').each(function() {
                        const card = $(this);
                        const combinedContent = `
                            <div>
                                <img src="${card.data('flagContent').match(/src="([^"]+)"/)[1]}" alt="Flag of ${card.data('country')}" style="max-width: 80px; max-height: 60px; margin-bottom: 8px;">
                                <p>${card.data('country')}</p>
                                <p>${card.data('capital')}</p>
                            </div>
                        `;
                        card.find('.card-front').html(combinedContent).show();
                        card.find('.card-back').hide();
                    });
                    $('.card').off('click');
                } else {
                    $('.card').each(function() {
                        const card = $(this);
                        const frontCard = card.find('.card-front');
                        const backCard = card.find('.card-back');

                        if (card.hasClass('matched')) {
                            // Keep matched cards visible
                            frontCard.show();
                            backCard.hide();
                        } else if (card.data('type') === 'flag') {
                            frontCard.html(card.data('flagContent')).show();
                            backCard.hide();
                        } else {
                            frontCard.hide();
                            backCard.html(card.data('textContent')).show();
                        }
                    });
                    $('.card').on('click', handleCardClick);
                }
            });

            // Event handlers for board size buttons
            $('.boardsize4x2').click(() => startGame(4));
            $('.boardsize4x4').click(() => startGame(8));

            // Allow restarting the game when region is changed
            $('input[name="region"]').change(function() {
                // Restart the game with the current board size
                const boardSize = totalPairs;
                if (boardSize > 0) {
                    startGame(boardSize);
                }
            });
        });
    </script>
</head>

<body>
    <header>Match countries with their flags</header>
    <h1>Select a region:</h1>
    <div>
        <input type="radio" id="Africa" name="region" value="Africa"> <label for="Africa">Africa</label>
        <input type="radio" id="Asia" name="region" value="Asia"> <label for="Asia">Asia</label>
        <input type="radio" id="Europe" name="region" value="Europe"> <label for="Europe">Europe</label>
        <input type="radio" id="Americas" name="region" value="Americas"> <label for="Americas">Americas</label>
        <input type="radio" id="Oceania" name="region" value="Oceania"> <label for="Oceania">Oceania</label>
    </div>
    <h2>Choose the board size:</h2>
    <div class="boardsizes">
        <button class="boardsize4x2">4 x 2</button>
        <button class="boardsize4x4">4 x 4</button>
    </div>
    <div class="game-container-board"></div>
    <div>
        <h3 class="num-of-match-txt">Number of matches: 0</h3>
    </div>
    <div>
        <input type="button" id="show-answer" value="Show Answer">
    </div>
</body>
</html>
